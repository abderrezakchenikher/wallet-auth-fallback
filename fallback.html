<!DOCTYPE html> 
<html lang="fr">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Redirection Wallet</title>
   <script>
       async function openWallet() {
           // Récupérer les paramètres de l'URL
           const params = new URLSearchParams(window.location.search);
           const oobData = params.get('_oob');
           const urlData = params.get('_url');

           if (!oobData && !urlData) {
               alert("Paramètre '_oob' ou '_url' manquant !");
               return;
           }

           // Construire l'URL universelle HTTPS
           let universalLink = "https://rttdz.wuaze.com/wallet/?";
           if (oobData) {
               universalLink += `oob=${encodeURIComponent(oobData)}`;
           } else {
               universalLink += `_url=${encodeURIComponent(urlData)}`;
           }

           // Déterminer l'URL de fallback (store)
           const storeUrl = navigator.userAgent.includes('iPhone')
               ? 'https://apps.apple.com/app/idXXXXXXXXX'  // Remplace avec ton App Store ID
               : 'https://play.google.com/store/apps/details?id=com.walletbc';  // Remplace avec le package Android

           // Vérifier si l'URL existe avant de rediriger
           try {
               const response = await fetch(universalLink, { method: 'HEAD' });
               if (response.status === 404) {
                   console.warn("Page introuvable, redirection vers le store...");
                   window.location.href = storeUrl;
                   return;
               }
           } catch (error) {
               console.warn("Échec de l'accès à l'URL du Wallet, redirection vers le store...");
               window.location.href = storeUrl;
               return;
           }

           // Redirection vers l'application via l'URL universelle
           const startTime = new Date().getTime();
           window.location.href = universalLink;

           // Si l'utilisateur reste sur la page après 1.5s, il est redirigé vers le store
           setTimeout(() => {
               const elapsed = new Date().getTime() - startTime;
               if (elapsed < 2000) {
                   window.location.href = storeUrl;
               }
           }, 1500);
       }
   </script>
</head>
<body onload="openWallet()">
   <h2>Redirection en cours...</h2>
</body>
</html>
